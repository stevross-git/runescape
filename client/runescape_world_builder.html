<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuneScape World Builder</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            background: #2d2d2d;
            color: #FFD700;
            overflow: hidden;
        }
        
        .toolbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to bottom, #8B4513, #654321);
            border-bottom: 3px solid #FFD700;
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .toolbar h1 {
            color: #FFD700;
            margin: 0 20px 0 0;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .tool-group {
            margin-right: 20px;
            display: flex;
            align-items: center;
            background: rgba(0,0,0,0.3);
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .tool-group label {
            margin-right: 8px;
            font-size: 12px;
            color: #FFD700;
            font-weight: bold;
        }
        
        .tool-btn {
            background: linear-gradient(to bottom, #8B4513, #654321);
            border: 2px solid #FFD700;
            color: #FFD700;
            padding: 6px 12px;
            margin: 0 2px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 11px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            transition: all 0.2s;
        }
        
        .tool-btn:hover {
            background: linear-gradient(to bottom, #A0522D, #8B4513);
            box-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        
        .tool-btn.active {
            background: linear-gradient(to bottom, #FFD700, #FFA500);
            color: #000;
            text-shadow: none;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .canvas-container {
            position: fixed;
            top: 60px;
            left: 220px;
            right: 280px;
            bottom: 0;
            background: #1a1a1a;
            overflow: hidden;
            border: 2px solid #8B4513;
        }
        
        #worldCanvas {
            cursor: crosshair;
        }
        
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 220px;
            bottom: 0;
            background: linear-gradient(to bottom, #2d2d2d, #1a1a1a);
            border-right: 3px solid #8B4513;
            overflow-y: auto;
            padding: 15px;
        }
        
        .properties-panel {
            position: fixed;
            top: 60px;
            right: 0;
            width: 280px;
            bottom: 0;
            background: linear-gradient(to bottom, #2d2d2d, #1a1a1a);
            border-left: 3px solid #8B4513;
            overflow-y: auto;
            padding: 15px;
        }
        
        .custom-content-section {
            margin-bottom: 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            border-radius: 8px;
            padding: 10px;
        }
        
        .custom-content-section h3 {
            color: #FFD700;
            margin: 0 0 10px 0;
            font-size: 14px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            border-bottom: 1px solid #FFD700;
            padding-bottom: 5px;
        }
        
        .custom-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #666;
            border-radius: 4px;
            padding: 6px;
            margin: 3px 0;
            color: #FFF;
            font-size: 10px;
            transition: background 0.2s;
            cursor: pointer;
        }
        
        .custom-item:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #FFD700;
        }
        
        .custom-item-name {
            font-weight: bold;
            color: #FFD700;
            font-size: 11px;
        }
        
        .custom-item-stats {
            font-size: 9px;
            color: #CCC;
            margin-top: 2px;
        }
        
        .custom-refresh-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            font-weight: bold;
            width: 100%;
            margin-bottom: 8px;
        }
        
        .custom-refresh-btn:hover {
            background: linear-gradient(45deg, #FFA500, #FF8C00);
        }
        
        .empty-state {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 10px;
            font-size: 10px;
        }
        
        .tile-category {
            margin-bottom: 20px;
            background: rgba(139, 69, 19, 0.2);
            border: 2px solid #8B4513;
            border-radius: 8px;
            padding: 10px;
        }
        
        .tile-category h3 {
            color: #FFD700;
            margin: 0 0 10px 0;
            font-size: 14px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            border-bottom: 1px solid #8B4513;
            padding-bottom: 5px;
        }
        
        .tile-grid {
            display: grid;
            grid-template-columns: repeat(4, 45px);
            gap: 3px;
            justify-content: center;
        }
        
        .tile-btn {
            width: 45px;
            height: 45px;
            border: 2px solid #8B4513;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            border-radius: 5px;
            transition: all 0.2s;
            position: relative;
        }
        
        .tile-btn:hover {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            transform: scale(1.05);
        }
        
        .tile-btn.selected {
            border: 3px solid #FFD700;
            background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            transform: scale(1.1);
        }
        
        .tile-btn::after {
            content: attr(data-name);
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            color: #FFD700;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .tile-btn:hover::after {
            opacity: 1;
        }

        /* Tooltip System */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #FFD700;
            border-radius: 8px;
            padding: 12px;
            color: #FFD700;
            font-size: 12px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.7);
            max-width: 300px;
            min-width: 200px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip-title {
            color: #FFD700;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid #8B4513;
            padding-bottom: 4px;
        }

        .tooltip-category {
            color: #FFA500;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .tooltip-description {
            color: #E6E6E6;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .tooltip-stats {
            background: rgba(139, 69, 19, 0.3);
            border-radius: 4px;
            padding: 6px;
            margin: 6px 0;
        }

        .tooltip-stat {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
            font-size: 11px;
        }

        .tooltip-stat-label {
            color: #FFA500;
        }

        .tooltip-stat-value {
            color: #90EE90;
            font-weight: bold;
        }

        .tooltip-variants {
            background: rgba(75, 0, 130, 0.3);
            border-radius: 4px;
            padding: 6px;
            margin: 6px 0;
        }

        .tooltip-variants-title {
            color: #DDA0DD;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .tooltip-usage {
            color: #87CEEB;
            font-size: 10px;
            font-style: italic;
            margin-top: 8px;
        }

        .tooltip-keyboard {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 3px;
            padding: 2px 6px;
            font-family: monospace;
            color: #FFD700;
            font-size: 10px;
            margin: 0 2px;
        }
        
        .coords {
            position: fixed;
            bottom: 10px;
            left: 230px;
            background: rgba(139, 69, 19, 0.9);
            border: 2px solid #FFD700;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 12px;
            color: #FFD700;
            font-weight: bold;
        }
        
        .save-load {
            position: fixed;
            bottom: 10px;
            right: 290px;
        }
        
        .save-load button {
            background: linear-gradient(to bottom, #228B22, #006400);
            border: 2px solid #32CD32;
            color: #FFF;
            padding: 8px 15px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .save-load button:hover {
            background: linear-gradient(to bottom, #32CD32, #228B22);
            box-shadow: 0 0 10px rgba(50, 205, 50, 0.5);
        }
        
        .property-group {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(139, 69, 19, 0.2);
            border: 2px solid #8B4513;
            border-radius: 8px;
        }
        
        .property-group h4 {
            color: #FFD700;
            margin: 0 0 10px 0;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .property-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            background: rgba(0,0,0,0.5);
            border: 2px solid #8B4513;
            color: #FFD700;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .property-input:focus {
            border-color: #FFD700;
            outline: none;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        
        /* Claude Terminal Styles */
        .claude-terminal {
            position: fixed;
            top: 70px;
            right: 10px;
            width: 400px;
            height: 500px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #FFD700;
            border-radius: 10px;
            display: none;
            z-index: 2000;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        
        .terminal-header {
            background: linear-gradient(to bottom, #8B4513, #654321);
            padding: 10px;
            border-bottom: 2px solid #FFD700;
            color: #FFD700;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .terminal-close {
            background: #DC143C;
            color: white;
            border: none;
            padding: 2px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .terminal-output {
            height: 380px;
            overflow-y: auto;
            padding: 10px;
            color: #00FF00;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .terminal-input-area {
            padding: 10px;
            border-top: 1px solid #FFD700;
            display: flex;
            align-items: center;
        }
        
        .terminal-prompt {
            color: #FFD700;
            margin-right: 5px;
        }
        
        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #00FF00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            outline: none;
        }
        
        .terminal-message {
            margin-bottom: 5px;
        }
        
        .terminal-user {
            color: #FFD700;
        }
        
        .terminal-system {
            color: #00BFFF;
        }
        
        .terminal-error {
            color: #FF4500;
        }
        
        .terminal-success {
            color: #32CD32;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <h1>🏰 RuneScape World Builder</h1>
        
        <div class="tool-group">
            <button class="tool-btn active" data-tool="paint" 
                    data-tooltip-title="Paint Tool" 
                    data-tooltip-category="Drawing Tool"
                    data-tooltip-description="Paint tiles one by one or with a brush. Click and drag to paint multiple tiles."
                    data-tooltip-stats="Brush Size|Adjustable|Precision|High|Speed|Fast"
                    data-tooltip-usage="Left click to paint, drag for continuous painting. Use <span class='tooltip-keyboard'>Shift+Click</span> for straight lines.">🖌️ Paint</button>
            <button class="tool-btn" data-tool="erase"
                    data-tooltip-title="Erase Tool"
                    data-tooltip-category="Drawing Tool" 
                    data-tooltip-description="Remove tiles and return them to grass. Perfect for corrections and clearing areas."
                    data-tooltip-stats="Brush Size|Adjustable|Precision|High|Speed|Fast"
                    data-tooltip-usage="Left click to erase, drag for continuous erasing. <span class='tooltip-keyboard'>Ctrl+Z</span> to undo.">🧽 Erase</button>
            <button class="tool-btn" data-tool="fill"
                    data-tooltip-title="Fill Tool"
                    data-tooltip-category="Drawing Tool"
                    data-tooltip-description="Fill large connected areas with the selected tile type. Great for terrain creation."
                    data-tooltip-stats="Area Fill|Unlimited|Precision|Perfect|Speed|Instant"
                    data-tooltip-usage="Click on any tile to fill the entire connected area of that type.">🪣 Fill</button>
            <button class="tool-btn" data-tool="select"
                    data-tooltip-title="Select Tool"
                    data-tooltip-category="Utility Tool"
                    data-tooltip-description="Select and inspect tiles to see their properties and stats."
                    data-tooltip-stats="Info Display|Full|Selection|Single|Speed|Instant"
                    data-tooltip-usage="Click any tile to see its details, variants, and properties.">👆 Select</button>
        </div>
        
        <div class="tool-group">
            <label>Brush:</label>
            <input type="range" id="brushSize" min="1" max="10" value="1" style="width: 80px;">
            <span id="brushSizeDisplay">1</span>
        </div>
        
        <div class="tool-group">
            <button class="tool-btn" onclick="clearWorld()" 
                data-tooltip-title="Clear World" 
                data-tooltip-category="World Management"
                data-tooltip-description="Remove all tiles and reset the world to empty grass terrain."
                data-tooltip-stats="Action|Destructive|Undo|Not Available|Scope|Entire World"
                data-tooltip-usage="⚠️ Warning: This will permanently delete all your work. <span class='tooltip-keyboard'>Use with caution!</span>">🗑️ Clear</button>
            <button class="tool-btn" onclick="generateLumbridge()" 
                data-tooltip-title="Medieval Fantasy City" 
                data-tooltip-category="Template World"
                data-tooltip-description="Complete medieval city showcasing all advanced features: multi-variant tiles, AI systems, complex districts."
                data-tooltip-stats="Buildings|30+|Districts|5|Features|Castle, moat, markets, nobles|AI Ready|Full integration"
                data-tooltip-usage="Perfect demonstration of advanced world builder capabilities. <span class='tooltip-keyboard'>Features everything!</span>">🏰 Medieval City</button>
                
            <button class="tool-btn" onclick="generateVarrock()" 
                data-tooltip-title="Tropical Island Paradise" 
                data-tooltip-category="Template World"
                data-tooltip-description="Beautiful island setting with beaches, palm trees, resort village, and satellite islands."
                data-tooltip-stats="Biomes|Ocean, Beach, Jungle|Islands|3|Activities|Fishing, treasure hunting|Style|Tropical"
                data-tooltip-usage="Showcases biome diversity and natural world generation. <span class='tooltip-keyboard'>Perfect for adventures!</span>">🏝️ Tropical Island</button>
                
            <button class="tool-btn" onclick="generateFalador()" 
                data-tooltip-title="Australian Outback Town" 
                data-tooltip-category="Template World"
                data-tooltip-description="Authentic outback settlement with unique Australian elements: billabong, gum trees, gold mines, pub."
                data-tooltip-stats="Features|Billabong, airstrip, rodeo|Mining|Gold, iron ore|Culture|True Aussie elements|Terrain|Red earth, drought"
                data-tooltip-usage="Unique cultural showcase with distinctive Australian character. <span class='tooltip-keyboard'>G'day mate!</span>">🇦🇺 Outback Town</button>
            <button class="tool-btn" onclick="populateMonsters()">👹 Add Monsters</button>
            <button class="tool-btn" onclick="worldBuilder.exportWorldWithEntryPoints()">🚪 Export with Doors</button>
            <button class="tool-btn" onclick="worldBuilder.toggleTestMode()" id="testModeBtn">🎮 Test Mode</button>
            <button class="tool-btn" onclick="gameCommands.manualSave()" id="debugSaveBtn">🔧 Debug Save</button>
            <button class="tool-btn" onclick="showPlayerImageGenerator()" id="imageGenBtn" 
                data-tooltip-title="AI Image Generator" 
                data-tooltip-category="Content Creation"
                data-tooltip-description="Generate custom images using OpenAI's DALL-E. Create unique player avatars, monsters, or items."
                data-tooltip-stats="AI Model|DALL-E|Resolution|1024x1024|Format|PNG|Quality|High"
                data-tooltip-usage="Enter a detailed prompt and generate custom images. <span class='tooltip-keyboard'>Perfect for unique content!</span>">🎨 Player Image</button>
            <button class="tool-btn" onclick="toggleClaudeTerminal()" id="claudeTerminalBtn" 
                data-tooltip-title="Claude AI Terminal" 
                data-tooltip-category="AI Assistant"
                data-tooltip-description="Interactive AI terminal for creating monsters, NPCs, buildings, and more using natural language."
                data-tooltip-stats="AI Model|GPT-3.5-turbo|Features|Content Creation|Image Gen|DALL-E"
                data-tooltip-usage="Type commands like 'create a fire dragon' or 'add a blacksmith NPC'. <span class='tooltip-keyboard'>AI powered!</span>">💻 Claude Terminal</button>
        </div>
        
        <div class="tool-group">
            <label>Grid:</label>
            <input type="checkbox" id="showGrid" checked>
        </div>
    </div>
    
    <div class="sidebar">
        <div class="tile-category">
            <h3>🌍 Terrain</h3>
            <div class="tile-grid">
                <div class="tile-btn selected" data-type="grass" data-name="Grass" style="background: #228B22;" 
                    data-tooltip-title="Grass Terrain" 
                    data-tooltip-category="Terrain"
                    data-tooltip-description="Standard grass terrain for outdoor areas. Forms the base layer for most worlds."
                    data-tooltip-stats="Walkable|Yes|Tileable|Yes|Variants|10|Biome|Temperate"
                    data-tooltip-usage="Perfect for fields, meadows, and general outdoor areas. <span class='tooltip-keyboard'>Click</span> to place grass tiles.">🌱</div>
                <div class="tile-btn" data-type="dirt" data-name="Dirt" style="background: linear-gradient(135deg, #8B4513, #A0522D, #CD853F);" 
                    data-tooltip-title="Dirt Path" 
                    data-tooltip-category="Terrain"
                    data-tooltip-description="Earthy terrain for paths, roads, and cleared areas. Great for connecting different zones."
                    data-tooltip-stats="Walkable|Yes|Tileable|Yes|Variants|10|Biome|Universal"
                    data-tooltip-usage="Use for roads, paths, and cleared areas. Blends well with most terrain types.">🟫</div>
                <div class="tile-btn" data-type="stone" data-name="Stone" style="background: linear-gradient(135deg, #696969, #808080, #A9A9A9);" 
                    data-tooltip-title="Stone Floor" 
                    data-tooltip-category="Terrain"
                    data-tooltip-description="Durable stone flooring for buildings, dungeons, and fortified areas."
                    data-tooltip-stats="Walkable|Yes|Tileable|Yes|Variants|10|Durability|High"
                    data-tooltip-usage="Perfect for castle floors, dungeon passages, and stone structures. Very durable.">⛰️</div>
                <div class="tile-btn" data-type="cobblestone" data-name="Cobble" style="background: #A0A0A0;" 
                    data-tooltip-title="Cobblestone Path" 
                    data-tooltip-category="Terrain"
                    data-tooltip-description="Medieval-style cobblestone for roads, courtyards, and town squares."
                    data-tooltip-stats="Walkable|Yes|Tileable|Yes|Variants|10|Style|Medieval"
                    data-tooltip-usage="Great for town centers, castle courtyards, and main roads. Classic medieval look.">🧱</div>
                <div class="tile-btn" data-type="water" data-name="Water" style="background: linear-gradient(135deg, #4169E1, #1E90FF, #87CEEB);" 
                    data-tooltip-title="Water Tile" 
                    data-tooltip-category="Terrain"
                    data-tooltip-description="Deep water for rivers, lakes, and oceans. Blocks most movement but allows fishing."
                    data-tooltip-stats="Walkable|No|Swimmable|Yes|Fishable|Yes|Variants|10"
                    data-tooltip-usage="Create rivers, lakes, and moats. Can be used for fishing spots and water obstacles.">🌊</div>
                <div class="tile-btn" data-type="sand" data-name="Sand" style="background: linear-gradient(135deg, #F4A460, #DEB887, #D2B48C);" 
                    data-tooltip-title="Sand Terrain" 
                    data-tooltip-category="Terrain"
                    data-tooltip-description="Desert sand for beaches, dunes, and arid regions. Slower movement speed."
                    data-tooltip-stats="Walkable|Yes|Speed|Slow|Variants|10|Biome|Desert"
                    data-tooltip-usage="Perfect for beaches, deserts, and sandy areas. Provides natural barriers.">🏖️</div>
                <div class="tile-btn" data-type="mud" data-name="Mud" style="background: linear-gradient(135deg, #8B4513, #654321, #5D4037);" 
                    data-tooltip-title="Mud Terrain" 
                    data-tooltip-category="Terrain"
                    data-tooltip-description="Swampy mud terrain for marshes and wet areas. Very slow movement."
                    data-tooltip-stats="Walkable|Yes|Speed|Very Slow|Variants|10|Biome|Swamp"
                    data-tooltip-usage="Use for swamps, marshes, and muddy areas. Creates movement challenges.">💩</div>
                <div class="tile-btn" data-type="snow" data-name="Snow" style="background: linear-gradient(45deg, #F0F8FF, #E6F3FF); border: 1px solid #B0E0E6;" 
                    data-tooltip-title="Snow Terrain" 
                    data-tooltip-category="Terrain"
                    data-tooltip-description="Frozen snow for winter landscapes and arctic regions. Slippery surface."
                    data-tooltip-stats="Walkable|Yes|Speed|Normal|Variants|10|Biome|Arctic"
                    data-tooltip-usage="Create winter scenes, mountain peaks, and frozen landscapes.">🌨️</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>🏦 Banks & Shops</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="bank" data-name="Bank" style="background: #FFD700;" 
                    data-tooltip-title="Bank Building" 
                    data-tooltip-category="Financial"
                    data-tooltip-description="Central banking facility for storing items and gold. Essential for any town."
                    data-tooltip-stats="Capacity|Unlimited|Security|Maximum|Access|Public|Services|Storage"
                    data-tooltip-usage="Place near town centers. Players can store items, gold, and access their bank account here.">🏦</div>
                <div class="tile-btn" data-type="general_store" data-name="General" style="background: #8B4513;">🏪</div>
                <div class="tile-btn" data-type="magic_shop" data-name="Magic" style="background: #9932CC;">🔮</div>
                <div class="tile-btn" data-type="weapon_shop" data-name="Weapons" style="background: #CD853F;">⚔️</div>
                <div class="tile-btn" data-type="armor_shop" data-name="Armor" style="background: #A0A0A0;">🛡️</div>
                <div class="tile-btn" data-type="food_shop" data-name="Food" style="background: #FFB6C1;">🍞</div>
                <div class="tile-btn" data-type="rune_shop" data-name="Runes" style="background: #4169E1;">🔷</div>
                <div class="tile-btn" data-type="archery_shop" data-name="Archery" style="background: #228B22;">🏹</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>🏰 Buildings</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="house_small" data-name="House" style="background: #D2B48C;">🏠</div>
                <div class="tile-btn" data-type="house_large" data-name="Manor" style="background: #CD853F;">🏘️</div>
                <div class="tile-btn" data-type="castle" data-name="Castle" style="background: #696969;" 
                    data-tooltip-title="Royal Castle" 
                    data-tooltip-category="Building"
                    data-tooltip-description="Massive fortress serving as royal residence and military stronghold."
                    data-tooltip-stats="Size|Large|Defense|Maximum|Occupancy|50+|Type|Fortress"
                    data-tooltip-usage="Perfect centerpiece for kingdoms. Houses nobility, guards, and important NPCs.">🏰</div>
                <div class="tile-btn" data-type="tower_wizard" data-name="Wizard Tower" style="background: #9932CC;">🗼</div>
                <div class="tile-btn" data-type="church" data-name="Church" style="background: #F5DEB3;">⛪</div>
                <div class="tile-btn" data-type="inn" data-name="Inn" style="background: #8B4513;">🍺</div>
                <div class="tile-btn" data-type="windmill" data-name="Windmill" style="background: #F4A460;">🌾</div>
                <div class="tile-btn" data-type="lighthouse" data-name="Lighthouse" style="background: #FFFFFF;">🗼</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>🌳 Trees</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="tree_normal" data-name="Normal Tree" style="background: #228B22;">🌳</div>
                <div class="tile-btn" data-type="tree_oak" data-name="Oak Tree" style="background: #8FBC8F;" 
                    data-tooltip-title="Oak Tree" 
                    data-tooltip-category="Resource"
                    data-tooltip-description="Sturdy oak tree providing high-quality logs. Excellent for woodcutting training."
                    data-tooltip-stats="Resource|Oak Logs|Skill Level|15|Experience|37.5|Respawn|30s"
                    data-tooltip-usage="Essential woodcutting resource. Place in forests and near lumber mills.">🌳</div>
                <div class="tile-btn" data-type="tree_willow" data-name="Willow Tree" style="background: #90EE90;">🌿</div>
                <div class="tile-btn" data-type="tree_maple" data-name="Maple Tree" style="background: #FF6347;">🍁</div>
                <div class="tile-btn" data-type="tree_yew" data-name="Yew Tree" style="background: #2F4F4F;">🌲</div>
                <div class="tile-btn" data-type="tree_magic" data-name="Magic Tree" style="background: #9932CC;">🌳</div>
                <div class="tile-btn" data-type="tree_palm" data-name="Palm Tree" style="background: #32CD32;">🌴</div>
                <div class="tile-btn" data-type="tree_dead" data-name="Dead Tree" style="background: #696969;">🌳</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>⛏️ Mining</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="rock_copper" data-name="Copper" style="background: #CD853F;">🪨</div>
                <div class="tile-btn" data-type="rock_tin" data-name="Tin" style="background: #C0C0C0;">🪨</div>
                <div class="tile-btn" data-type="rock_iron" data-name="Iron" style="background: #A0A0A0;" 
                    data-tooltip-title="Iron Ore Rock" 
                    data-tooltip-category="Resource"
                    data-tooltip-description="Common iron ore deposit. Essential for smithing weapons and armor."
                    data-tooltip-stats="Resource|Iron Ore|Skill Level|15|Experience|35|Respawn|5.4s"
                    data-tooltip-usage="Key mining resource for mid-level players. Place near mining areas and forges.">🪨</div>
                <div class="tile-btn" data-type="rock_coal" data-name="Coal" style="background: #2F2F2F;">⚫</div>
                <div class="tile-btn" data-type="rock_gold" data-name="Gold" style="background: #FFD700;">🟡</div>
                <div class="tile-btn" data-type="rock_mithril" data-name="Mithril" style="background: #4169E1;">🔵</div>
                <div class="tile-btn" data-type="rock_adamant" data-name="Adamant" style="background: #90EE90;">🟢</div>
                <div class="tile-btn" data-type="rock_rune" data-name="Runite" style="background: #40E0D0;">🔷</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>🎣 Skills</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="fishing_spot" data-name="Fishing" style="background: #4169E1;" 
                    data-tooltip-title="Fishing Spot" 
                    data-tooltip-category="Resource Location"
                    data-tooltip-description="Abundant fishing location with various fish species. Requires fishing rod."
                    data-tooltip-stats="Skill|Fishing|Fish Types|5+|Experience|Variable|Tools|Rod, Net, Harpoon"
                    data-tooltip-usage="Must be placed adjacent to water tiles. Different spots yield different fish types.">🎣</div>
                <div class="tile-btn" data-type="furnace" data-name="Furnace" style="background: #FF4500;" 
                    data-tooltip-title="Smithing Furnace" 
                    data-tooltip-category="Skill Station"
                    data-tooltip-description="High-temperature furnace for smelting ores into bars. Essential smithing equipment."
                    data-tooltip-stats="Skill|Smithing|Function|Smelting|Heat Level|Maximum|Fuel|Coal"
                    data-tooltip-usage="Place near mining areas and anvils. Players use this to smelt ores into usable bars.">🔥</div>
                <div class="tile-btn" data-type="anvil" data-name="Anvil" style="background: #2F2F2F;">⚒️</div>
                <div class="tile-btn" data-type="altar" data-name="Altar" style="background: #9932CC;">⛩️</div>
                <div class="tile-btn" data-type="spinning_wheel" data-name="Spinning" style="background: #DEB887;">🎡</div>
                <div class="tile-btn" data-type="pottery_wheel" data-name="Pottery" style="background: #CD853F;">🏺</div>
                <div class="tile-btn" data-type="loom" data-name="Loom" style="background: #8B4513;">🧵</div>
                <div class="tile-btn" data-type="cooking_range" data-name="Range" style="background: #FF6347;">🍳</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>👹 Low Level Monsters</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="monster_rat" data-name="Giant Rat" style="background: #8B4513;">🐀</div>
                <div class="tile-btn" data-type="monster_goblin" data-name="Goblin" style="background: #8B0000;" 
                    data-tooltip-title="Goblin" 
                    data-tooltip-category="Low Level Monster"
                    data-tooltip-description="Weak but aggressive humanoid creature. Perfect for new players to practice combat."
                    data-tooltip-stats="Combat Level|2|Hitpoints|15|Max Hit|2|Drops|Bones, Coins"
                    data-tooltip-usage="Great starter monster for combat training. Place in groups for realistic encounters.">👹</div>
                <div class="tile-btn" data-type="monster_imp" data-name="Imp" style="background: #8B008B;">👺</div>
                <div class="tile-btn" data-type="monster_spider" data-name="Giant Spider" style="background: #2F2F2F;">🕷️</div>
                <div class="tile-btn" data-type="monster_chicken" data-name="Chicken" style="background: #FFFF00;">🐔</div>
                <div class="tile-btn" data-type="monster_cow" data-name="Cow" style="background: #FFFFFF;">🐄</div>
                <div class="tile-btn" data-type="monster_sheep" data-name="Sheep" style="background: #F5F5DC;">🐑</div>
                <div class="tile-btn" data-type="monster_frog" data-name="Giant Frog" style="background: #228B22;">🐸</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>⚔️ Medium Level Monsters</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="monster_skeleton" data-name="Skeleton" style="background: #F5F5DC;">💀</div>
                <div class="tile-btn" data-type="monster_zombie" data-name="Zombie" style="background: #556B2F;">🧟</div>
                <div class="tile-btn" data-type="monster_guard" data-name="Guard" style="background: #4169E1;">🛡️</div>
                <div class="tile-btn" data-type="monster_knight" data-name="Knight" style="background: #C0C0C0;">⚔️</div>
                <div class="tile-btn" data-type="monster_bandit" data-name="Bandit" style="background: #8B4513;">🏴‍☠️</div>
                <div class="tile-btn" data-type="monster_barbarian" data-name="Barbarian" style="background: #CD853F;">🪓</div>
                <div class="tile-btn" data-type="monster_wizard" data-name="Dark Wizard" style="background: #9932CC;">🧙</div>
                <div class="tile-btn" data-type="monster_dwarf" data-name="Dwarf" style="background: #B8860B;">⛏️</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>🐉 High Level Monsters</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="monster_dragon_green" data-name="Green Dragon" style="background: #228B22;" 
                    data-tooltip-title="Green Dragon" 
                    data-tooltip-category="High Level Monster"
                    data-tooltip-description="Powerful dragon with deadly dragonfire breath. High-level combat challenge."
                    data-tooltip-stats="Combat Level|79|Hitpoints|500|Max Hit|50|Drops|Dragon Bones, Hide"
                    data-tooltip-usage="Dangerous high-level monster. Place in remote areas with sufficient space for combat.">🐉</div>
                <div class="tile-btn" data-type="monster_dragon_red" data-name="Red Dragon" style="background: #DC143C;">🐲</div>
                <div class="tile-btn" data-type="monster_dragon_black" data-name="Black Dragon" style="background: #2F2F2F;">🖤</div>
                <div class="tile-btn" data-type="monster_demon" data-name="Demon" style="background: #8B0000;">😈</div>
                <div class="tile-btn" data-type="monster_giant" data-name="Giant" style="background: #A0522D;">🦣</div>
                <div class="tile-btn" data-type="monster_troll" data-name="Troll" style="background: #696969;">👹</div>
                <div class="tile-btn" data-type="monster_ogre" data-name="Ogre" style="background: #8FBC8F;">👹</div>
                <div class="tile-btn" data-type="monster_lich" data-name="Lich" style="background: #483D8B;">☠️</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>🏆 Boss Monsters</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="monster_king_black_dragon" data-name="King Black Dragon" style="background: #000000;">👑</div>
                <div class="tile-btn" data-type="monster_chaos_elemental" data-name="Chaos Elemental" style="background: #9932CC;">🌀</div>
                <div class="tile-btn" data-type="monster_barrows_brother" data-name="Barrows Brother" style="background: #2F4F4F;">⚰️</div>
                <div class="tile-btn" data-type="monster_jad" data-name="TzTok-Jad" style="background: #FF4500;">🔥</div>
                <div class="tile-btn" data-type="monster_godwars_boss" data-name="God Wars Boss" style="background: #FFD700;">⚡</div>
                <div class="tile-btn" data-type="monster_kraken" data-name="Kraken" style="background: #4682B4;">🐙</div>
                <div class="tile-btn" data-type="monster_corp_beast" data-name="Corporeal Beast" style="background: #2F2F2F;">👹</div>
                <div class="tile-btn" data-type="monster_wilderness_boss" data-name="Wilderness Boss" style="background: #8B0000;">💀</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>📍 Spawn Points</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="spawn_single" data-name="Single Spawn" style="background: #FFD700;">⭐</div>
                <div class="tile-btn" data-type="spawn_multi" data-name="Multi Spawn" style="background: #FFA500;">🎯</div>
                <div class="tile-btn" data-type="spawn_boss" data-name="Boss Spawn" style="background: #FF4500;">👑</div>
                <div class="tile-btn" data-type="spawn_safe_zone" data-name="Safe Zone" style="background: #32CD32;">🛡️</div>
                <div class="tile-btn" data-type="spawn_player" data-name="Player Spawn" style="background: #00BFFF;">🏠</div>
                <div class="tile-btn" data-type="spawn_respawn" data-name="Respawn Point" style="background: #9932CC;">🔄</div>
                <div class="tile-btn" data-type="spawn_teleport" data-name="Teleport" style="background: #40E0D0;">🌀</div>
                <div class="tile-btn" data-type="spawn_dungeon" data-name="Dungeon Entry" style="background: #2F4F4F;">🕳️</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>👤 Shop NPCs</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="npc_banker" data-name="Banker" style="background: #FFD700;">🏦</div>
                <div class="tile-btn" data-type="npc_shopkeeper" data-name="Shopkeeper" style="background: #8B4513;">🛒</div>
                <div class="tile-btn" data-type="npc_weapon_trader" data-name="Weapon Trader" style="background: #CD853F;">⚔️</div>
                <div class="tile-btn" data-type="npc_armor_trader" data-name="Armor Trader" style="background: #A0A0A0;">🛡️</div>
                <div class="tile-btn" data-type="npc_magic_trader" data-name="Magic Trader" style="background: #9932CC;">🔮</div>
                <div class="tile-btn" data-type="npc_food_trader" data-name="Food Trader" style="background: #FFB6C1;">🍞</div>
                <div class="tile-btn" data-type="npc_rune_trader" data-name="Rune Trader" style="background: #4169E1;">🔷</div>
                <div class="tile-btn" data-type="npc_archery_trader" data-name="Archery Trader" style="background: #228B22;">🏹</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>🎭 Quest NPCs</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="npc_quest_giver" data-name="Quest Giver" style="background: #FFD700;">❗</div>
                <div class="tile-btn" data-type="npc_quest_helper" data-name="Quest Helper" style="background: #32CD32;">❓</div>
                <div class="tile-btn" data-type="npc_sage" data-name="Wise Sage" style="background: #9932CC;">🧙‍♂️</div>
                <div class="tile-btn" data-type="npc_oracle" data-name="Oracle" style="background: #FF69B4;">🔮</div>
                <div class="tile-btn" data-type="npc_librarian" data-name="Librarian" style="background: #8B4513;">📚</div>
                <div class="tile-btn" data-type="npc_researcher" data-name="Researcher" style="background: #4682B4;">🔬</div>
                <div class="tile-btn" data-type="npc_archaeologist" data-name="Archaeologist" style="background: #CD853F;">🏺</div>
                <div class="tile-btn" data-type="npc_explorer" data-name="Explorer" style="background: #228B22;">🗺️</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>⚔️ Skill NPCs</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="npc_combat_trainer" data-name="Combat Trainer" style="background: #DC143C;">⚔️</div>
                <div class="tile-btn" data-type="npc_magic_trainer" data-name="Magic Trainer" style="background: #9932CC;">🧙</div>
                <div class="tile-btn" data-type="npc_smithing_trainer" data-name="Smithing Trainer" style="background: #2F2F2F;">⚒️</div>
                <div class="tile-btn" data-type="npc_crafting_trainer" data-name="Crafting Trainer" style="background: #DEB887;">🧵</div>
                <div class="tile-btn" data-type="npc_mining_trainer" data-name="Mining Trainer" style="background: #696969;">⛏️</div>
                <div class="tile-btn" data-type="npc_fishing_trainer" data-name="Fishing Trainer" style="background: #4169E1;">🎣</div>
                <div class="tile-btn" data-type="npc_cooking_trainer" data-name="Cooking Trainer" style="background: #FF6347;">👨‍🍳</div>
                <div class="tile-btn" data-type="npc_prayer_trainer" data-name="Prayer Trainer" style="background: #FFD700;">🙏</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>🏛️ Authority NPCs</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="npc_king" data-name="King" style="background: #FFD700;">👑</div>
                <div class="tile-btn" data-type="npc_duke" data-name="Duke" style="background: #4169E1;">🎩</div>
                <div class="tile-btn" data-type="npc_guard_captain" data-name="Guard Captain" style="background: #C0C0C0;">🛡️</div>
                <div class="tile-btn" data-type="npc_judge" data-name="Judge" style="background: #8B4513;">⚖️</div>
                <div class="tile-btn" data-type="npc_tax_collector" data-name="Tax Collector" style="background: #B8860B;">💰</div>
                <div class="tile-btn" data-type="npc_herald" data-name="Herald" style="background: #9932CC;">📢</div>
                <div class="tile-btn" data-type="npc_diplomat" data-name="Diplomat" style="background: #4682B4;">📜</div>
                <div class="tile-btn" data-type="npc_mayor" data-name="Mayor" style="background: #228B22;">🏛️</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>👥 Civilian NPCs</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="npc_citizen" data-name="Citizen" style="background: #F5DEB3;">👤</div>
                <div class="tile-btn" data-type="npc_farmer" data-name="Farmer" style="background: #228B22;">👨‍🌾</div>
                <div class="tile-btn" data-type="npc_fisherman" data-name="Fisherman" style="background: #4169E1;">🎣</div>
                <div class="tile-btn" data-type="npc_miner" data-name="Miner" style="background: #696969;">⛏️</div>
                <div class="tile-btn" data-type="npc_blacksmith" data-name="Blacksmith" style="background: #2F2F2F;">🔨</div>
                <div class="tile-btn" data-type="npc_merchant" data-name="Merchant" style="background: #B8860B;">💼</div>
                <div class="tile-btn" data-type="npc_bard" data-name="Bard" style="background: #9932CC;">🎵</div>
                <div class="tile-btn" data-type="npc_child" data-name="Child" style="background: #FFB6C1;">👶</div>
            </div>
        </div>
        
        <div class="tile-category">
            <h3>🗡️ Objects</h3>
            <div class="tile-grid">
                <div class="tile-btn" data-type="well" data-name="Well" style="background: #708090;">⚫</div>
                <div class="tile-btn" data-type="fence_wood" data-name="Wood Fence" style="background: #8B4513;">🚧</div>
                <div class="tile-btn" data-type="fence_stone" data-name="Stone Fence" style="background: #696969;">🧱</div>
                <div class="tile-btn" data-type="gate_wood" data-name="Wood Gate" style="background: #654321;">🚪</div>
                <div class="tile-btn" data-type="gate_metal" data-name="Metal Gate" style="background: #A0A0A0;">🚪</div>
                <div class="tile-btn" data-type="chest" data-name="Chest" style="background: #8B4513;">📦</div>
                <div class="tile-btn" data-type="statue" data-name="Statue" style="background: #D3D3D3;">🗿</div>
                <div class="tile-btn" data-type="bridge" data-name="Bridge" style="background: #8B4513;">🌉</div>
            </div>
        </div>
        
        <!-- Custom Content Section -->
        <div class="custom-content-section">
            <h3>🎮 Custom Content</h3>
            <button class="custom-refresh-btn" onclick="refreshCustomContent()" 
                data-tooltip-title="Refresh Custom Content" 
                data-tooltip-category="Content Management"
                data-tooltip-description="Reload all custom monsters, NPCs, buildings, objects, and quests from the database."
                data-tooltip-stats="Source|Database|Update|Live|Cache|Cleared"
                data-tooltip-usage="Use after creating new content via Claude Terminal to see updates immediately.">🔄 Refresh</button>
        </div>
        
        <div class="custom-content-section">
            <h3>👹 Custom Monsters</h3>
            <div id="customMonsters">
                <div class="empty-state">No custom monsters yet.<br>Use Claude Terminal!</div>
            </div>
        </div>
        
        <div class="custom-content-section">
            <h3>👤 Custom NPCs</h3>
            <div id="customNPCs">
                <div class="empty-state">No custom NPCs yet.<br>Use Claude Terminal!</div>
            </div>
        </div>
        
        <div class="custom-content-section">
            <h3>🏠 Custom Buildings</h3>
            <div id="customBuildings">
                <div class="empty-state">No custom buildings yet.<br>Use Claude Terminal!</div>
            </div>
        </div>
        
        <div class="custom-content-section">
            <h3>📦 Custom Objects</h3>
            <div id="customObjects">
                <div class="empty-state">No custom objects yet.<br>Use Claude Terminal!</div>
            </div>
        </div>
        
        <div class="custom-content-section">
            <h3>📜 Custom Quests</h3>
            <div id="customQuests">
                <div class="empty-state">No custom quests yet.<br>Use Claude Terminal!</div>
            </div>
        </div>
        
        <div class="custom-content-section">
            <h3>🗺️ Saved Worlds</h3>
            <div id="savedWorlds">
                <div class="empty-state">Loading...</div>
            </div>
        </div>
        
        <div class="custom-content-section">
            <h3>🎯 Quick Actions</h3>
            <button class="custom-refresh-btn" onclick="openClaudeTerminal()" style="background: linear-gradient(45deg, #4CAF50, #45a049);">💬 Claude Terminal</button>
            <button class="custom-refresh-btn" onclick="openAdmin()" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">⚙️ Admin Panel</button>
        </div>
    </div>
    
    <div class="canvas-container">
        <canvas id="worldCanvas" width="1600" height="1200"></canvas>
    </div>
    
    <div class="properties-panel">
        <div class="property-group">
            <h4>Selected Tile</h4>
            <div>Type: <span id="selectedType">grass</span></div>
            <input type="text" class="property-input" id="tileName" placeholder="Custom name">
        </div>
        
        <div class="property-group" id="monsterConfig" style="display: none;">
            <h4>🗡️ Monster Configuration</h4>
            <label>Monster Type:</label>
            <select class="property-input" id="monsterType">
                <option value="monster_goblin">Goblin</option>
                <option value="monster_skeleton">Skeleton</option>
                <option value="monster_dragon_green">Green Dragon</option>
            </select>
            
            <label>Spawn Quantity:</label>
            <input type="number" class="property-input" id="spawnQuantity" value="1" min="1" max="50">
            
            <label>Respawn Time (seconds):</label>
            <input type="number" class="property-input" id="respawnTime" value="30" min="5" max="3600">
            
            <label>Combat Level:</label>
            <input type="number" class="property-input" id="combatLevel" value="2" min="1" max="999">
            
            <label>Max Health:</label>
            <input type="number" class="property-input" id="maxHealth" value="15" min="1" max="10000">
            
            <label>Spawn Radius:</label>
            <input type="range" class="property-input" id="spawnRadius" value="3" min="1" max="10">
            <span id="spawnRadiusDisplay">3 tiles</span>
            
            <label>
                <input type="checkbox" id="aggressiveMonster"> Aggressive
            </label>
            <label>
                <input type="checkbox" id="roamingMonster" checked> Can Roam
            </label>
            
            <button class="tool-btn" onclick="applyMonsterConfig()">Apply Config</button>
        </div>
        
        <div class="property-group" id="spawnConfig" style="display: none;">
            <h4>📍 Spawn Point Configuration</h4>
            <label>Spawn Type:</label>
            <select class="property-input" id="spawnType">
                <option value="single">Single Monster</option>
                <option value="multi">Multiple Monsters</option>
                <option value="boss">Boss Monster</option>
                <option value="safe_zone">Safe Zone</option>
                <option value="player">Player Spawn</option>
                <option value="respawn">Respawn Point</option>
            </select>
            
            <label>Associated Monster:</label>
            <select class="property-input" id="spawnMonster">
                <option value="">None</option>
                <option value="monster_goblin">Goblin</option>
                <option value="monster_skeleton">Skeleton</option>
                <option value="monster_dragon_green">Green Dragon</option>
            </select>
            
            <label>Max Spawned:</label>
            <input type="number" class="property-input" id="maxSpawned" value="3" min="1" max="20">
            
            <label>Spawn Interval (seconds):</label>
            <input type="number" class="property-input" id="spawnInterval" value="45" min="5" max="1800">
            
            <label>Spawn Area Size:</label>
            <input type="range" class="property-input" id="spawnAreaSize" value="5" min="1" max="15">
            <span id="spawnAreaDisplay">5x5 tiles</span>
            
            <button class="tool-btn" onclick="applySpawnConfig()">Apply Config</button>
        </div>
        
        <div class="property-group" id="npcConfig" style="display: none;">
            <h4>👤 NPC Configuration</h4>
            <label>NPC Name:</label>
            <input type="text" class="property-input" id="npcName" placeholder="Enter NPC name">
            
            <label>NPC Type:</label>
            <select class="property-input" id="npcType">
                <option value="shopkeeper">Shopkeeper</option>
                <option value="trainer">Skill Trainer</option>
                <option value="quest">Quest Giver</option>
                <option value="authority">Authority Figure</option>
                <option value="civilian">Civilian</option>
            </select>
            
            <label>Shop Type (if applicable):</label>
            <select class="property-input" id="shopType">
                <option value="">None</option>
                <option value="general">General Store</option>
                <option value="weapons">Weapon Shop</option>
                <option value="armor">Armor Shop</option>
                <option value="magic">Magic Shop</option>
                <option value="food">Food Shop</option>
                <option value="runes">Rune Shop</option>
                <option value="archery">Archery Shop</option>
                <option value="bank">Banking</option>
            </select>
            
            <label>Skill Taught (if trainer):</label>
            <select class="property-input" id="skillTaught">
                <option value="">None</option>
                <option value="attack">Attack</option>
                <option value="defense">Defense</option>
                <option value="strength">Strength</option>
                <option value="magic">Magic</option>
                <option value="smithing">Smithing</option>
                <option value="mining">Mining</option>
                <option value="fishing">Fishing</option>
                <option value="cooking">Cooking</option>
                <option value="crafting">Crafting</option>
                <option value="prayer">Prayer</option>
            </select>
            
            <label>Combat Level:</label>
            <input type="number" class="property-input" id="npcCombatLevel" value="0" min="0" max="999">
            
            <label>
                <input type="checkbox" id="npcCanAttack"> Can be attacked
            </label>
            <label>
                <input type="checkbox" id="npcRoaming"> Can move around
            </label>
            <label>
                <input type="checkbox" id="npcHasQuest"> Has quest
            </label>
            
            <label>Dialogue:</label>
            <textarea class="property-input" id="npcDialogue" rows="3" placeholder="Enter NPC dialogue..."></textarea>
            
            <button class="tool-btn" onclick="applyNPCConfig()">Apply Config</button>
        </div>
        
        <div class="property-group">
            <h4>Position</h4>
            <div>Mouse X: <span id="mouseX">0</span></div>
            <div>Mouse Y: <span id="mouseY">0</span></div>
            <div>Grid X: <span id="gridX">0</span></div>
            <div>Grid Y: <span id="gridY">0</span></div>
        </div>
        
        <div class="property-group">
            <h4>World Settings</h4>
            <label>World Width:</label>
            <input type="number" class="property-input" id="worldWidth" value="150" min="50" max="500">
            <label>World Height:</label>
            <input type="number" class="property-input" id="worldHeight" value="100" min="50" max="500">
            <label>Tile Size:</label>
            <input type="number" class="property-input" id="tileSize" value="16" min="8" max="64">
        </div>
        
        <div class="property-group">
            <h4>Quick Templates</h4>
            <button class="tool-btn" onclick="generateWilderness()">☠️ Wilderness</button>
            <button class="tool-btn" onclick="generateDesert()">🏜️ Desert</button>
            <button class="tool-btn" onclick="generateIsland()">🏝️ Island</button>
            <button class="tool-btn" onclick="generateForest()">🌲 Forest</button>
        </div>
        
        <div class="property-group">
            <h4>Export Options</h4>
            <button class="tool-btn" onclick="exportWorld()">📤 Export JSON</button>
            <button class="tool-btn" onclick="exportImages()">🖼️ Export Images</button>
            <button class="tool-btn" onclick="generateCode()">💾 Generate Code</button>
        </div>
    </div>
    
    
    <div class="coords">
        Position: <span id="coordsDisplay">0, 0</span> | Tile: <span id="selectedType">grass</span>
    </div>
    
    <div class="save-load">
        <button onclick="saveWorld()" 
            data-tooltip-title="Save World" 
            data-tooltip-category="World Management"
            data-tooltip-description="Save your current world design to the database with a custom name."
            data-tooltip-stats="Storage|Database|Format|SQLite|Backup|Automatic"
            data-tooltip-usage="Enter a name for your world and save it permanently. Can be loaded anytime later.">💾 Save World</button>
        <button onclick="loadWorld()" 
            data-tooltip-title="Load World" 
            data-tooltip-category="World Management"
            data-tooltip-description="Browse and load previously saved worlds from your collection."
            data-tooltip-stats="Source|Database|Preview|Available|Import|Instant"
            data-tooltip-usage="Select from your saved worlds list. Current work will be replaced with loaded world.">📁 Load World</button>
        <button onclick="gameCommands.manualSave()" style="background: linear-gradient(to bottom, #FF6347, #DC143C);">🚨 Test Save</button>
        <button onclick="exportToGame()" style="background: linear-gradient(45deg, #4CAF50, #45a049);">🎮 Export to Game</button>
        <input type="file" id="fileInput" style="display: none;" accept=".json">
    </div>
    
    
    <!-- Claude Terminal -->
    <div id="claudeTerminal" class="claude-terminal">
        <div class="terminal-header">
            💻 Claude Code Terminal
            <button class="terminal-close" onclick="toggleClaudeTerminal()">×</button>
        </div>
        <div id="terminalOutput" class="terminal-output">
            <div class="terminal-message terminal-system">🚀 Claude Code Terminal v1.0</div>
            <div class="terminal-message terminal-system">Connected to RuneScape World Builder</div>
            <div class="terminal-message terminal-system">Type commands to interact with Claude AI...</div>
            <div class="terminal-message terminal-system">Commands: help, analyze, create, modify, export, save</div>
            <div class="terminal-message"></div>
        </div>
        <div class="terminal-input-area">
            <span class="terminal-prompt">claude></span>
            <input type="text" id="terminalInput" class="terminal-input" placeholder="Type a command..." onkeypress="handleTerminalInput(event)">
        </div>
    </div>
    
    <!-- Player Image Generator Modal -->
    <div id="imageGeneratorModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(to bottom, #2d2d2d, #1a1a1a); padding: 30px; border-radius: 10px; border: 3px solid #FFD700; width: 500px; max-width: 90vw;">
            <h2 style="color: #FFD700; text-align: center; margin: 0 0 20px 0;">🎨 AI Player Image Generator</h2>
            
            <div style="margin-bottom: 15px;">
                <label style="color: #FFD700; display: block; margin-bottom: 5px;">Describe your character:</label>
                <textarea id="imagePrompt" placeholder="e.g., A brave female knight with silver armor and a red cape, holding a sword..." 
                    style="width: 100%; height: 80px; padding: 10px; background: rgba(0,0,0,0.5); border: 2px solid #8B4513; color: #FFD700; border-radius: 5px; font-family: 'Courier New', monospace; resize: vertical;"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="color: #FFD700; display: block; margin-bottom: 5px;">Art Style:</label>
                <select id="imageStyle" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.5); border: 2px solid #8B4513; color: #FFD700; border-radius: 5px; font-family: 'Courier New', monospace;">
                    <option value="fantasy">Fantasy</option>
                    <option value="runescape">RuneScape Style</option>
                    <option value="realistic">Realistic</option>
                    <option value="anime">Anime</option>
                    <option value="pixel">Pixel Art</option>
                </select>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button onclick="generatePlayerImageFromModal()" style="background: linear-gradient(to bottom, #228B22, #006400); border: 2px solid #32CD32; color: #FFF; padding: 12px 20px; margin: 0 10px; cursor: pointer; border-radius: 5px; font-weight: bold;">
                    🎨 Generate Image
                </button>
                <button onclick="generateVariationsFromModal()" style="background: linear-gradient(to bottom, #FF8C00, #FF6347); border: 2px solid #FFD700; color: #FFF; padding: 12px 20px; margin: 0 10px; cursor: pointer; border-radius: 5px; font-weight: bold;">
                    🎭 Generate 3 Variations
                </button>
            </div>
            
            <div id="imageGenerationStatus" style="color: #FFD700; text-align: center; margin-bottom: 15px; min-height: 20px;"></div>
            
            <div style="text-align: center;">
                <button onclick="closePlayerImageGenerator()" style="background: linear-gradient(to bottom, #8B4513, #654321); border: 2px solid #FFD700; color: #FFD700; padding: 10px 20px; cursor: pointer; border-radius: 5px; font-weight: bold;">
                    Close
                </button>
                <button onclick="showPlayerImageGallery()" style="background: linear-gradient(to bottom, #4169E1, #1E90FF); border: 2px solid #87CEEB; color: #FFF; padding: 10px 20px; margin-left: 10px; cursor: pointer; border-radius: 5px; font-weight: bold;">
                    📁 View Gallery
                </button>
            </div>
            
            <div style="margin-top: 15px; color: #FFD700; font-size: 12px; text-align: center;">
                💡 Tip: Be descriptive! Include details about armor, weapons, hair, expression, pose, etc.
            </div>
        </div>
    </div>

    <!-- Player Image Gallery Modal -->
    <div id="imageGalleryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2001;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(to bottom, #2d2d2d, #1a1a1a); padding: 20px; border-radius: 10px; border: 3px solid #FFD700; width: 90vw; max-width: 1000px; height: 80vh; overflow: hidden;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #FFD700; margin: 0;">🖼️ Player Image Gallery</h2>
                <button onclick="closePlayerImageGallery()" style="background: linear-gradient(to bottom, #8B4513, #654321); border: 2px solid #FFD700; color: #FFD700; padding: 8px 15px; cursor: pointer; border-radius: 5px; font-weight: bold;">
                    ✕ Close
                </button>
            </div>
            
            <div id="galleryContent" style="height: calc(100% - 80px); overflow-y: auto; padding: 10px;">
                <!-- Gallery images will be populated here -->
            </div>
            
            <div style="text-align: center; margin-top: 15px;">
                <button onclick="clearPlayerImagesWithConfirm()" style="background: linear-gradient(to bottom, #DC143C, #8B0000); border: 2px solid #FF6347; color: #FFF; padding: 8px 15px; cursor: pointer; border-radius: 5px; font-weight: bold;">
                    🗑️ Clear All Images
                </button>
                <span style="color: #FFD700; margin: 0 15px; font-size: 12px;" id="galleryCount"></span>
                <button onclick="refreshGallery()" style="background: linear-gradient(to bottom, #228B22, #006400); border: 2px solid #32CD32; color: #FFF; padding: 8px 15px; cursor: pointer; border-radius: 5px; font-weight: bold;">
                    🔄 Refresh
                </button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js/runescape_world_builder.js"></script>
    
    <script>
        // Initialize socket connection for Claude terminal
        let socket;
        try {
            socket = io();
            console.log('🌐 Socket.IO connected for Claude terminal');
        } catch (error) {
            console.warn('Socket.IO not available:', error);
        }
    </script>
    
    <script>
        function showPlayerImageGenerator() {
            // Check if OpenAI API key is set
            if (!worldBuilder.openAI_NPCs.apiKey) {
                alert('⚠️ OpenAI API key not loaded!\n\nThe key should auto-load from your .env file.\nIf this persists, check the console for details.');
                return;
            }
            
            document.getElementById('imageGeneratorModal').style.display = 'block';
            document.getElementById('imagePrompt').focus();
        }
        
        function closePlayerImageGenerator() {
            document.getElementById('imageGeneratorModal').style.display = 'none';
            document.getElementById('imageGenerationStatus').innerHTML = '';
        }
        
        async function generatePlayerImageFromModal() {
            const prompt = document.getElementById('imagePrompt').value.trim();
            const style = document.getElementById('imageStyle').value;
            const statusDiv = document.getElementById('imageGenerationStatus');
            
            if (!prompt) {
                statusDiv.innerHTML = '⚠️ Please enter a character description';
                return;
            }
            
            statusDiv.innerHTML = '🎨 Generating your player image...';
            
            try {
                const result = await gameCommands.generatePlayerImage(prompt, style);
                if (result.success) {
                    statusDiv.innerHTML = '✅ Image generated successfully! Opening in new tab...';
                    setTimeout(() => {
                        statusDiv.innerHTML = '';
                    }, 3000);
                } else {
                    statusDiv.innerHTML = `❌ Generation failed: ${result.error}`;
                }
            } catch (error) {
                statusDiv.innerHTML = `❌ Error: ${error.message}`;
            }
        }
        
        async function generateVariationsFromModal() {
            const prompt = document.getElementById('imagePrompt').value.trim();
            const statusDiv = document.getElementById('imageGenerationStatus');
            
            if (!prompt) {
                statusDiv.innerHTML = '⚠️ Please enter a character description';
                return;
            }
            
            statusDiv.innerHTML = '🎭 Generating 3 variations... This may take a moment...';
            
            try {
                const results = await gameCommands.generatePlayerVariations(prompt, 3);
                if (results.length > 0) {
                    statusDiv.innerHTML = `✅ Generated ${results.length} variations! Check console for details.`;
                    setTimeout(() => {
                        statusDiv.innerHTML = '';
                    }, 5000);
                } else {
                    statusDiv.innerHTML = '❌ No variations could be generated';
                }
            } catch (error) {
                statusDiv.innerHTML = `❌ Error: ${error.message}`;
            }
        }
        
        // Close modal when clicking outside
        document.getElementById('imageGeneratorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePlayerImageGenerator();
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.getElementById('imageGeneratorModal').style.display === 'block') {
                    closePlayerImageGenerator();
                } else if (document.getElementById('imageGalleryModal').style.display === 'block') {
                    closePlayerImageGallery();
                }
            }
        });

        // Gallery functions
        function showPlayerImageGallery() {
            document.getElementById('imageGalleryModal').style.display = 'block';
            refreshGallery();
        }

        function closePlayerImageGallery() {
            document.getElementById('imageGalleryModal').style.display = 'none';
        }

        function refreshGallery() {
            const images = worldBuilder.openAI_NPCs.getPlayerImages();
            const galleryContent = document.getElementById('galleryContent');
            const galleryCount = document.getElementById('galleryCount');

            if (images.length === 0) {
                galleryContent.innerHTML = `
                    <div style="text-align: center; color: #FFD700; margin-top: 50px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">🖼️</div>
                        <h3>No Images Generated Yet</h3>
                        <p>Use the image generator to create your first player avatar!</p>
                        <button onclick="closePlayerImageGallery(); showPlayerImageGenerator();" 
                            style="background: linear-gradient(to bottom, #228B22, #006400); border: 2px solid #32CD32; color: #FFF; padding: 12px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; margin-top: 15px;">
                            🎨 Generate Your First Image
                        </button>
                    </div>
                `;
                galleryCount.textContent = '';
                return;
            }

            galleryCount.textContent = `${images.length} image${images.length !== 1 ? 's' : ''}`;

            // Create gallery grid
            let galleryHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">';
            
            images.reverse().forEach((img, index) => {
                const date = new Date(img.generatedAt).toLocaleString();
                const actualIndex = images.length - index; // Correct index for opening
                
                galleryHTML += `
                    <div style="background: rgba(0,0,0,0.3); border: 2px solid #8B4513; border-radius: 8px; padding: 10px; transition: all 0.3s; cursor: pointer;" 
                         onmouseover="this.style.borderColor='#FFD700'" 
                         onmouseout="this.style.borderColor='#8B4513'"
                         onclick="openPlayerImageFromGallery('${img.url}', ${actualIndex})">
                        <div style="aspect-ratio: 1; background: url('${img.url}') center/cover; border-radius: 5px; margin-bottom: 8px; position: relative;">
                            <div style="position: absolute; top: 5px right: 5px; background: rgba(0,0,0,0.8); color: #FFD700; padding: 2px 6px; border-radius: 3px; font-size: 10px;">
                                #${actualIndex}
                            </div>
                        </div>
                        <div style="color: #FFD700; font-size: 11px; margin-bottom: 5px;">
                            📅 ${date}
                        </div>
                        <div style="color: #FFF; font-size: 12px; line-height: 1.3; max-height: 40px; overflow: hidden;">
                            ${img.prompt.length > 80 ? img.prompt.substring(0, 80) + '...' : img.prompt}
                        </div>
                        <div style="margin-top: 8px; text-align: center;">
                            <button onclick="event.stopPropagation(); openPlayerImageFromGallery('${img.url}', ${actualIndex})" 
                                style="background: linear-gradient(to bottom, #4169E1, #1E90FF); border: 1px solid #87CEEB; color: #FFF; padding: 4px 8px; cursor: pointer; border-radius: 3px; font-size: 10px; margin-right: 5px;">
                                🔍 View
                            </button>
                            <button onclick="event.stopPropagation(); copyImageUrl('${img.url}')" 
                                style="background: linear-gradient(to bottom, #228B22, #006400); border: 1px solid #32CD32; color: #FFF; padding: 4px 8px; cursor: pointer; border-radius: 3px; font-size: 10px;">
                                📋 Copy URL
                            </button>
                        </div>
                    </div>
                `;
            });
            
            galleryHTML += '</div>';
            galleryContent.innerHTML = galleryHTML;
        }

        function openPlayerImageFromGallery(url, index) {
            console.log(`🖼️ Opening image #${index}`);
            window.open(url, '_blank');
        }

        function copyImageUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                // Show temporary feedback
                const originalText = event.target.innerHTML;
                event.target.innerHTML = '✅ Copied!';
                event.target.style.background = 'linear-gradient(to bottom, #32CD32, #228B22)';
                setTimeout(() => {
                    event.target.innerHTML = originalText;
                    event.target.style.background = 'linear-gradient(to bottom, #228B22, #006400)';
                }, 1000);
            }).catch(() => {
                alert('Could not copy URL. Check console for the link.');
                console.log('Image URL:', url);
            });
        }

        function clearPlayerImagesWithConfirm() {
            const images = worldBuilder.openAI_NPCs.getPlayerImages();
            if (images.length === 0) {
                alert('No images to clear!');
                return;
            }
            
            if (confirm(`Are you sure you want to delete all ${images.length} generated images?\n\nThis action cannot be undone.`)) {
                worldBuilder.openAI_NPCs.clearPlayerImages();
                refreshGallery();
                console.log('🗑️ All player images cleared');
            }
        }

        // Close gallery when clicking outside
        document.getElementById('imageGalleryModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePlayerImageGallery();
            }
        });

        // Claude Terminal System
        let terminalVisible = false;
        let terminalHistory = [];
        let historyIndex = -1;
        let pendingRequest = false;
        
        function toggleClaudeTerminal() {
            const terminal = document.getElementById('claudeTerminal');
            terminalVisible = !terminalVisible;
            terminal.style.display = terminalVisible ? 'block' : 'none';
            
            if (terminalVisible) {
                console.log('🖥️ CLAUDE TERMINAL OPENED:', {
                    timestamp: new Date().toISOString(),
                    status: 'TERMINAL_ACTIVE'
                });
                document.getElementById('terminalInput').focus();
                addTerminalMessage('system', '💻 Terminal opened. Type "help" for available commands.');
            } else {
                console.log('🖥️ CLAUDE TERMINAL CLOSED:', {
                    timestamp: new Date().toISOString(),
                    status: 'TERMINAL_CLOSED'
                });
            }
        }
        
        function addTerminalMessage(type, message) {
            const output = document.getElementById('terminalOutput');
            const messageDiv = document.createElement('div');
            messageDiv.className = `terminal-message terminal-${type}`;
            messageDiv.textContent = message;
            output.appendChild(messageDiv);
            output.scrollTop = output.scrollHeight;
        }
        
        function handleTerminalInput(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('terminalInput');
                const command = input.value.trim();
                
                if (command) {
                    // Add command to history
                    terminalHistory.push(command);
                    historyIndex = terminalHistory.length;
                    
                    // Display the command
                    addTerminalMessage('user', `claude> ${command}`);
                    
                    // Process the command
                    processTerminalCommand(command);
                    
                    // Clear input
                    input.value = '';
                }
            } else if (event.key === 'ArrowUp') {
                // Navigate command history up
                if (historyIndex > 0) {
                    historyIndex--;
                    document.getElementById('terminalInput').value = terminalHistory[historyIndex];
                }
                event.preventDefault();
            } else if (event.key === 'ArrowDown') {
                // Navigate command history down
                if (historyIndex < terminalHistory.length - 1) {
                    historyIndex++;
                    document.getElementById('terminalInput').value = terminalHistory[historyIndex];
                } else {
                    historyIndex = terminalHistory.length;
                    document.getElementById('terminalInput').value = '';
                }
                event.preventDefault();
            }
        }
        
        function processTerminalCommand(command) {
            const cmd = command.toLowerCase().split(' ')[0];
            const args = command.split(' ').slice(1).join(' ');
            
            console.log('⚙️ PROCESSING TERMINAL COMMAND:', {
                timestamp: new Date().toISOString(),
                fullCommand: command,
                parsedCommand: cmd,
                arguments: args,
                status: 'PROCESSING'
            });
            
            if (pendingRequest) {
                addTerminalMessage('error', '⏳ Please wait for the previous request to complete...');
                return;
            }
            
            switch (cmd) {
                case 'help':
                    showTerminalHelp();
                    break;
                case 'analyze':
                    analyzeWorld(args);
                    break;
                case 'create':
                    createFeature(args);
                    break;
                case 'modify':
                    modifyFeature(args);
                    break;
                case 'export':
                    exportWorld(args);
                    break;
                case 'save':
                    saveWorldCommand();
                    break;
                case 'status':
                    showWorldStatus();
                    break;
                case 'clear':
                    clearTerminal();
                    break;
                case 'history':
                    showCommandHistory();
                    break;
                default:
                    // Send to Claude Code for processing
                    sendToClaudeCode(command);
                    break;
            }
        }
        
        function showTerminalHelp() {
            addTerminalMessage('system', '📖 Claude Terminal Commands:');
            addTerminalMessage('system', '• help - Show this help menu');
            addTerminalMessage('system', '• analyze [what] - Analyze world or specific feature');
            addTerminalMessage('system', '• create [feature] - Request to create new feature');
            addTerminalMessage('system', '• modify [feature] - Request to modify existing feature');
            addTerminalMessage('system', '• export [format] - Export world data');
            addTerminalMessage('system', '• save - Save current world');
            addTerminalMessage('system', '• status - Show current world status');
            addTerminalMessage('system', '• clear - Clear terminal output');
            addTerminalMessage('system', '• history - Show command history');
            addTerminalMessage('system', '• [anything else] - Send directly to Claude Code');
        }
        
        function analyzeWorld(args) {
            addTerminalMessage('system', '🔍 Analyzing world...');
            
            if (!worldBuilder || !worldBuilder.worldData) {
                addTerminalMessage('error', '❌ World not initialized');
                return;
            }
            
            const analysis = gameCommands.analyzeWorld();
            addTerminalMessage('success', `✅ Analysis complete:`);
            addTerminalMessage('system', `📊 World: ${worldBuilder.worldWidth}x${worldBuilder.worldHeight}`);
            addTerminalMessage('system', `🏗️ Tiles: ${worldBuilder.tilesPlaced || 0} placed`);
            
            if (args) {
                addTerminalMessage('system', `📝 Specific analysis for "${args}" requested`);
                sendToClaudeCode(`Analyze my world's ${args} in detail`);
            }
        }
        
        function createFeature(args) {
            if (!args) {
                addTerminalMessage('error', '❌ Please specify what to create (e.g., "create castle" or "create NPC dialogue system")');
                return;
            }
            
            addTerminalMessage('system', `🔨 Requesting Claude to create: ${args}`);
            sendToClaudeCode(`Please help me create ${args} in my RuneScape world builder`);
        }
        
        function modifyFeature(args) {
            if (!args) {
                addTerminalMessage('error', '❌ Please specify what to modify (e.g., "modify combat system" or "modify UI layout")');
                return;
            }
            
            addTerminalMessage('system', `🔧 Requesting Claude to modify: ${args}`);
            sendToClaudeCode(`Please help me modify ${args} in my RuneScape world builder`);
        }
        
        function saveWorldCommand() {
            addTerminalMessage('system', '💾 Saving world...');
            try {
                gameCommands.manualSave();
                addTerminalMessage('success', '✅ World saved successfully');
            } catch (error) {
                addTerminalMessage('error', `❌ Save failed: ${error.message}`);
            }
        }
        
        function showWorldStatus() {
            addTerminalMessage('system', '📊 Current World Status:');
            addTerminalMessage('system', `🌍 Dimensions: ${worldBuilder.worldWidth}x${worldBuilder.worldHeight}`);
            addTerminalMessage('system', `🏗️ Tiles Placed: ${worldBuilder.tilesPlaced || 0}`);
            addTerminalMessage('system', `🎮 Mode: ${document.getElementById('testModeIndicator')?.textContent || 'BUILD MODE'}`);
            
            if (worldBuilder.autoSave) {
                addTerminalMessage('system', `💾 Auto-save: ${worldBuilder.autoSave.autoSaveEnabled ? 'Enabled' : 'Disabled'}`);
            }
        }
        
        function clearTerminal() {
            document.getElementById('terminalOutput').innerHTML = `
                <div class="terminal-message terminal-system">🚀 Claude Code Terminal v1.0</div>
                <div class="terminal-message terminal-system">Terminal cleared</div>
                <div class="terminal-message"></div>
            `;
        }
        
        function showCommandHistory() {
            addTerminalMessage('system', '📜 Command History:');
            terminalHistory.slice(-10).forEach((cmd, i) => {
                addTerminalMessage('system', `${terminalHistory.length - 10 + i + 1}: ${cmd}`);
            });
        }
        
        function sendToClaudeCode(userCommand) {
            pendingRequest = true;
            addTerminalMessage('system', '🤖 Sending request to Claude Code...');
            addTerminalMessage('system', `📝 Request: "${userCommand}"`);
            
            try {
                // Gather world context
                const worldContext = gatherWorldContextForClaude();
                
                // Show detailed progress
                addTerminalMessage('system', '📊 Gathering world context...');
                addTerminalMessage('system', `🌍 World analyzed: ${worldContext.split('\n').length} data points`);
                addTerminalMessage('success', '✅ Request sent to Claude Code');
                
                // Create message for Claude Code with status callback
                const message = `PLAYER REQUEST FROM RUNESCAPE WORLD BUILDER:
"${userCommand}"

CURRENT WORLD STATE:
${worldContext}

Please help with this request by modifying the codebase as needed. The player is using the in-game terminal to communicate with you directly.

IMPORTANT: Use the following commands to update the player's terminal:
- claudeStatus("🔍 Analyzing existing code...")
- claudeStatus("✏️ Making modifications...")  
- claudeStatus("🔧 Applying changes...")
- claudeStatus("✅ Task completed!")

Call claudeStatus() with your actual progress messages so the player sees what you're really doing.

CLAUDE RECEIPT CONFIRMATION:
Please start your response with: console.log('📥 MESSAGE RECEIVED BY CLAUDE:', { timestamp: '${new Date().toISOString()}', command: '${userCommand}', status: 'RECEIVED' });`;

                // Log the request for debugging
                console.log('📤 MESSAGE SENT TO CLAUDE CODE:', {
                    timestamp: new Date().toISOString(),
                    command: userCommand,
                    worldData: worldContext.split('\n').length + ' data points',
                    status: 'SENT'
                });
                console.log('🤖 Claude Code Request:', message);
                
                // Send message to server for Claude Code to receive automatically
                fetch('/claude/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        command: userCommand,
                        worldContext: worldContext,
                        fullMessage: message
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        addTerminalMessage('success', '🚀 Message sent to Claude Code automatically!');
                        addTerminalMessage('system', `📨 Message ID: ${data.messageId}`);
                        addTerminalMessage('system', '🎯 Claude will receive this in the terminal session');
                    } else {
                        addTerminalMessage('error', '❌ Failed to send message to Claude Code');
                    }
                })
                .catch(error => {
                    addTerminalMessage('error', `❌ Network error: ${error.message}`);
                    console.error('Failed to send to Claude Code:', error);
                });
                
                // Set up real-time status updates
                setupClaudeStatusListener();
                
                pendingRequest = false;
                
            } catch (error) {
                addTerminalMessage('error', `❌ Failed to send request: ${error.message}`);
                pendingRequest = false;
            }
        }
        
        // Global function for Claude to call for status updates
        window.claudeStatus = function(message) {
            addTerminalMessage('system', message);
        };
        
        // Global function for Claude to signal completion
        window.claudeComplete = function(message = '✅ Task completed!') {
            addTerminalMessage('success', message);
            pendingRequest = false;
        };
        
        // Global function for Claude to signal errors
        window.claudeError = function(message) {
            addTerminalMessage('error', `❌ ${message}`);
            pendingRequest = false;
        };
        
        function setupClaudeStatusListener() {
            // Set up listener for real-time updates from Claude via WebSocket
            addTerminalMessage('system', '👂 Listening for real-time Claude updates...');
            
            // If socket.io is available, listen for updates
            if (typeof socket !== 'undefined' && socket) {
                // Remove any existing listeners to prevent duplicates
                socket.off('claudeUpdate');
                socket.off('autoRefresh');
                
                // Listen for Claude updates
                socket.on('claudeUpdate', (data) => {
                    addTerminalMessage(data.type, data.status);
                    
                    if (data.type === 'success' || data.type === 'error') {
                        pendingRequest = false;
                    }
                });
                
                // Listen for auto-refresh
                socket.on('autoRefresh', (data) => {
                    addTerminalMessage('success', `🔄 Changes applied! Auto-refreshing... (${data.reason})`);
                    setTimeout(() => {
                        // Only refresh custom content instead of full page reload
                        if (typeof refreshCustomContent === 'function') {
                            refreshCustomContent();
                            addTerminalMessage('success', '✅ Custom content refreshed!');
                        } else {
                            location.reload();
                        }
                    }, 2000);
                });
                
                addTerminalMessage('success', '🌐 Connected to real-time Claude updates!');
            } else {
                // Fallback for when socket.io is not available
                addTerminalMessage('system', '⚠️ Real-time updates not available, using fallback...');
                setTimeout(() => {
                    addTerminalMessage('system', '🔍 Claude is processing your request...');
                    setTimeout(() => {
                        addTerminalMessage('success', '✅ Request processed! Check for changes.');
                        pendingRequest = false;
                    }, 3000);
                }, 1000);
            }
        }
        
        function gatherWorldContextForClaude() {
            if (!worldBuilder || !worldBuilder.worldData) {
                return 'World not initialized';
            }
            
            // Count tile types
            const tileCounts = {};
            let totalNonGrass = 0;
            
            for (let y = 0; y < worldBuilder.worldHeight; y++) {
                for (let x = 0; x < worldBuilder.worldWidth; x++) {
                    const tile = worldBuilder.worldData[y][x];
                    if (tile.type !== 'grass') {
                        tileCounts[tile.type] = (tileCounts[tile.type] || 0) + 1;
                        totalNonGrass++;
                    }
                }
            }
            
            const context = `
World Dimensions: ${worldBuilder.worldWidth}x${worldBuilder.worldHeight}
Mode: ${document.getElementById('testModeIndicator')?.textContent || 'BUILD MODE'}
Total Elements: ${totalNonGrass} non-grass tiles
Buildings: ${Object.keys(tileCounts).filter(type => type.includes('house') || type.includes('shop') || type.includes('bank') || type.includes('castle')).length}
NPCs: ${Object.keys(tileCounts).filter(type => type.startsWith('npc_')).length}
Monsters: ${Object.keys(tileCounts).filter(type => type.startsWith('monster_')).length}

Top Tile Types:
${Object.entries(tileCounts).sort(([,a], [,b]) => b - a).slice(0, 5).map(([type, count]) => `• ${type}: ${count}`).join('\n')}
`;
            
            return context;
        }

        // ============================================
        // 🎯 TOOLTIP SYSTEM
        // ============================================
        
        let tooltipElement = null;
        
        function initializeTooltipSystem() {
            // Create tooltip element
            tooltipElement = document.createElement('div');
            tooltipElement.className = 'tooltip';
            tooltipElement.id = 'gameTooltip';
            document.body.appendChild(tooltipElement);
            
            // Add event listeners to all elements with tooltip data
            const elementsWithTooltips = document.querySelectorAll('[data-tooltip-title]');
            
            elementsWithTooltips.forEach(element => {
                element.addEventListener('mouseenter', showTooltip);
                element.addEventListener('mouseleave', hideTooltip);
                element.addEventListener('mousemove', updateTooltipPosition);
            });
            
            console.log(`🎯 Initialized tooltip system for ${elementsWithTooltips.length} elements`);
        }
        
        function showTooltip(event) {
            const element = event.target;
            
            // Extract tooltip data
            const title = element.dataset.tooltipTitle;
            const category = element.dataset.tooltipCategory;
            const description = element.dataset.tooltipDescription;
            const stats = element.dataset.tooltipStats;
            const usage = element.dataset.tooltipUsage;
            const variants = element.dataset.tooltipVariants;
            
            if (!title) return;
            
            // Build tooltip content
            let content = `
                <div class="tooltip-title">${title}</div>
                <div class="tooltip-category">${category}</div>
                <div class="tooltip-description">${description}</div>
            `;
            
            // Add stats if available
            if (stats) {
                content += '<div class="tooltip-stats"><div class="tooltip-stats-title">📊 Stats</div>';
                const statPairs = stats.split('|');
                for (let i = 0; i < statPairs.length; i += 2) {
                    if (statPairs[i] && statPairs[i + 1]) {
                        content += `
                            <div class="tooltip-stat">
                                <span class="tooltip-stat-label">${statPairs[i]}:</span>
                                <span class="tooltip-stat-value">${statPairs[i + 1]}</span>
                            </div>
                        `;
                    }
                }
                content += '</div>';
            }
            
            // Add variants if available
            if (variants) {
                content += `
                    <div class="tooltip-variants">
                        <div class="tooltip-variants-title">🎨 Variants</div>
                        <div>${variants}</div>
                    </div>
                `;
            }
            
            // Add usage if available
            if (usage) {
                content += `
                    <div class="tooltip-usage">
                        <div class="tooltip-usage-title">💡 Usage</div>
                        <div>${usage}</div>
                    </div>
                `;
            }
            
            // Set tooltip content and show
            tooltipElement.innerHTML = content;
            tooltipElement.classList.add('show');
            
            // Position tooltip
            updateTooltipPosition(event);
        }
        
        function hideTooltip() {
            if (tooltipElement) {
                tooltipElement.classList.remove('show');
            }
        }
        
        function updateTooltipPosition(event) {
            if (!tooltipElement || !tooltipElement.classList.contains('show')) return;
            
            const mouseX = event.clientX;
            const mouseY = event.clientY;
            const tooltipRect = tooltipElement.getBoundingClientRect();
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            
            let left = mouseX + 15;
            let top = mouseY + 15;
            
            // Adjust if tooltip would go off screen
            if (left + tooltipRect.width > windowWidth) {
                left = mouseX - tooltipRect.width - 15;
            }
            
            if (top + tooltipRect.height > windowHeight) {
                top = mouseY - tooltipRect.height - 15;
            }
            
            // Ensure tooltip doesn't go off screen on left/top
            left = Math.max(10, left);
            top = Math.max(10, top);
            
            tooltipElement.style.left = left + 'px';
            tooltipElement.style.top = top + 'px';
        }
        
        // Initialize tooltip system when page loads
        document.addEventListener('DOMContentLoaded', initializeTooltipSystem);
        
        // Also initialize after a short delay to catch any dynamically loaded content
        setTimeout(initializeTooltipSystem, 1000);
    </script>
</body>
</html>
